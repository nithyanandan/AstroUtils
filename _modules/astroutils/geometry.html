<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>astroutils.geometry &mdash; AstroUtils 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="AstroUtils 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astroutils.geometry</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">NP</span>
<span class="kn">import</span> <span class="nn">healpy</span> <span class="kn">as</span> <span class="nn">HP</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span> <span class="k">as</span> <span class="n">KDT</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">KDTree</span> <span class="k">as</span> <span class="n">KDT</span>

<span class="kn">import</span> <span class="nn">ipdb</span> <span class="kn">as</span> <span class="nn">PDB</span>
<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.Point">[docs]</a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ----------------------------------------------------------------------------</span>
<span class="sd">    Class to manage 3-dimensional locations in a Cartesian coordinate system.</span>

<span class="sd">    Attributes:</span>

<span class="sd">    x       [Scalar] x-coordinate </span>

<span class="sd">    y       [Scalar] y-coordinate</span>

<span class="sd">    z       [Scalar] z-coordinate</span>

<span class="sd">    Member functions:</span>

<span class="sd">    __init__():   Initializes an instance of class Point</span>

<span class="sd">    __str__():    Prints the coordinates stored in the instance</span>

<span class="sd">    __add__():    Operator overloading to add two vectors which are represented</span>
<span class="sd">                  as instances of class Point</span>

<span class="sd">    __sub__():    Operator overloading to subtract one vector from another</span>
<span class="sd">                  which are both represented as instances of class Point</span>

<span class="sd">    __mul__():    Operator overloading to multiply two vectors represented as </span>
<span class="sd">                  instances of Point class and produce a dot product. </span>

<span class="sd">    __rmul__():   Operator overlaoding to multiply a vector represented as </span>
<span class="sd">                  instance of Point class with a scalar value. </span>

<span class="sd">    ----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        -------------------------------------------------------------------------</span>
<span class="sd">        Initializes an instance of class Point</span>

<span class="sd">        Inputs:</span>

<span class="sd">        xyz    [Tuple, list or scalar] If not provided, the instance of class</span>
<span class="sd">               Point is initialized to (0.0, 0.0, 0.0). If scalar is provided, it</span>
<span class="sd">               is assigned to the x value. The y and z values are both set to 0.0.</span>
<span class="sd">               If a list or tuple is provided, the first element is assigned to x,</span>
<span class="sd">               the second to y, and the third to z. If the second or third</span>
<span class="sd">               elements are not provided, a value 0.0 is assigned to the </span>
<span class="sd">               corresponding coordinates. If more than three elements are </span>
<span class="sd">               provided, only the first three values are used and the others </span>
<span class="sd">               ignored. Default = None which initializes to (0.0, 0.0, 0.0).</span>

<span class="sd">        Class attributes initialized are:</span>
<span class="sd">        x, y, z</span>

<span class="sd">        Read docstring of class Point for details on these attributes.</span>
<span class="sd">        -------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">z</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span> <span class="c1"># input is list or tuple</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xyz</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Data type mismatch. Check input again.&#39;</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;({0}, {1}, {2})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        -------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to add two vectors which are represented as</span>
<span class="sd">        instances of class Point</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [instance of class Point] The instance of class Point which is</span>
<span class="sd">                  to be added to the current instance. </span>

<span class="sd">        -------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;No object provided for addition.&#39;</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Object type is incompatible.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Point</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">+</span><span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
 
    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to subtract one vector from another which are both</span>
<span class="sd">        represented as instances of class Point</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [instance of class Point] The instance of class Point which is</span>
<span class="sd">                  to be subtracted from the current instance. </span>

<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;No object provided for subtraction.&#39;</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Object type is incompatible.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Point</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

    <span class="c1"># def __mul__(self, value):</span>
    <span class="c1">#     return Point(value*self.x, value*self.y, value*self.z)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c1"># Dot product</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to multiply two vectors represented as instances of</span>
<span class="sd">        class Point and produce a dot product</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [instance of class Point] The instance of class Point which is</span>
<span class="sd">                  to be multiplied with the current instance to yield a dot </span>
<span class="sd">                  product. </span>

<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;No object provided for product.&#39;</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Object type is incompatible.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">z</span>

    <span class="c1"># __rmul__ = __mul__</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="c1"># scalar product</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to multiply a vector represented as instance of</span>
<span class="sd">        class Point with a scalar value</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [scalar int or float] The scalar value which scales the</span>
<span class="sd">                  current instance to yield a scaled vector</span>

<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;No scalar value provided for product.&#39;</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value is incompatible for product.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Point</span><span class="p">((</span><span class="n">value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

    <span class="c1">#############################################################################</span>
    
    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to give the magnitude of the  vector represented as </span>
<span class="sd">        instance of class Point</span>

<span class="sd">        Output(s): [float] Magnitude of the vector represented as an instance of </span>
<span class="sd">                   class Point</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to check if the magnitude of the vector represented </span>
<span class="sd">        as instance of class Point is lesser than that of another vector given </span>
<span class="sd">        as instance of Point class</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [scalar int or float] Instance of Point class with which the </span>
<span class="sd">                  current instance will be compared to</span>

<span class="sd">        Output(s): [Boolean] True if magnitude of current class is lesser than </span>
<span class="sd">                   that of the other vector to be compared to, False otherwise.</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No object provided for comparison.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The object provided for comparison must be an instance of class Point.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to check if the magnitude of the vector represented </span>
<span class="sd">        as instance of class Point is lesser than or equal to that of another </span>
<span class="sd">        vector given as instance of Point class</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [scalar int or float] Instance of Point class with which the </span>
<span class="sd">                  current instance will be compared to</span>

<span class="sd">        Output(s): [Boolean] True if magnitude of current class is lesser than </span>
<span class="sd">                   or equal to that of the other vector to be compared to, False</span>
<span class="sd">                   otherwise.</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No object provided for comparison.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The object provided for comparison must be an instance of class Point.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to check if the magnitude of the vector represented </span>
<span class="sd">        as instance of class Point is greater than that of another vector given </span>
<span class="sd">        as instance of Point class</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [scalar int or float] Instance of Point class with which the </span>
<span class="sd">                  current instance will be compared to</span>

<span class="sd">        Output(s): [Boolean] True if magnitude of current class is greater than </span>
<span class="sd">                   that of the other vector to be compared to, False otherwise.</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No object provided for comparison.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The object provided for comparison must be an instance of class Point.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to check if the magnitude of the vector represented </span>
<span class="sd">        as instance of class Point is greater than or equal to that of another </span>
<span class="sd">        vector given as instance of Point class</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [scalar int or float] Instance of Point class with which the </span>
<span class="sd">                  current instance will be compared to</span>

<span class="sd">        Output(s): [Boolean] True if magnitude of current class is greater than </span>
<span class="sd">                   or equal to that of the other vector to be compared to, False</span>
<span class="sd">                   otherwise.</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No object provided for comparison.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The object provided for comparison must be an instance of class Point.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1">#############################################################################</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        Operator overloading to check if the magnitude of the vector represented </span>
<span class="sd">        as instance of class Point is equal to that of another vector given as</span>
<span class="sd">        instance of Point class</span>

<span class="sd">        Input(s):</span>

<span class="sd">        other     [scalar int or float] Instance of Point class with which the </span>
<span class="sd">                  current instance will be compared to</span>

<span class="sd">        Output(s): [Boolean] True if magnitude of current class is equal to that</span>
<span class="sd">                   of the other vector to be compared to, False otherwise.</span>
<span class="sd">        ------------------------------------------------------------------------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No object provided for comparison.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The object provided for comparison must be an instance of class Point.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="altaz2dircos"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.altaz2dircos">[docs]</a><span class="k">def</span> <span class="nf">altaz2dircos</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert altitude and azimuth to direction cosines</span>

<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">    altaz:       Altitude and Azimuth as a list of tuples or Nx2 Numpy array</span>
<span class="sd">    </span>
<span class="sd">    Keyword Inputs:</span>

<span class="sd">    units:       [Default = &#39;radians&#39;] Units of altitude and azimuth. Could be</span>
<span class="sd">                 radians or degrees. </span>

<span class="sd">    Output:</span>
<span class="sd">    </span>
<span class="sd">    dircos:      Direction cosines corresponding to altitude and azimuth. The</span>
<span class="sd">                 first axis corresponds to local East, second to local North and</span>
<span class="sd">                 the third corresponds to Up.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">altaz</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No altitude or azimuth specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">altaz</span> <span class="o">=</span> <span class="p">(</span><span class="n">altaz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">altaz</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">altaz</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="n">altaz</span> <span class="o">=</span> <span class="p">[((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">altaz</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">altaz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">altaz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">altaz</span> <span class="o">=</span> <span class="n">altaz</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">altaz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;radians&#39;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">altaz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Altitude(s) should lie between -90 and 90 degrees. Check inputs and units.&#39;</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">altaz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Convert azimuth (measured from north towards east) to angle measured from east towards north</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># towards east</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># towards north</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>             <span class="c1"># towards zenith</span>

    <span class="k">return</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="dircos2altaz"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.dircos2altaz">[docs]</a><span class="k">def</span> <span class="nf">dircos2altaz</span><span class="p">(</span><span class="n">dircos</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert direction cosines to altitude and azimuth</span>

<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">    dircos:      directin cosines as a list of tuples or Nx3 Numpy array</span>
<span class="sd">    </span>
<span class="sd">    Keyword Inputs:</span>

<span class="sd">    units:       [Default = &#39;radians&#39;] Units of altitude and azimuth. Could be</span>
<span class="sd">                 radians or degrees. </span>

<span class="sd">    Output:</span>
<span class="sd">    </span>
<span class="sd">    altaz:       Altitude and azimuth corresponding to direction cosines. </span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">dircos</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No direction cosines specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dircos</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dircos</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dircos</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dircos should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dircos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">dircos</span> <span class="o">=</span> <span class="p">(</span><span class="n">dircos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dircos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dircos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dircos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dircos should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dircos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">dircos</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dircos should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dircos should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="n">dircos</span> <span class="o">=</span> <span class="p">[((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">dircos</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dircos</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dircos should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dircos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dircos should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dircos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dircos</span> <span class="o">=</span> <span class="n">dircos</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">dircos</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dircos</span><span class="p">)</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dircos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">))</span> <span class="ow">or</span>
        <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dircos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">))</span> <span class="ow">or</span>
        <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dircos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">))</span> <span class="ow">or</span>
        <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dircos</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">))):</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Individual components of direction cosines should lie between 0 and 1 and the direction cosines should have unit magnitudes. Check inputs.&#39;</span><span class="p">)</span>

    <span class="n">altaz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">dircos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dircos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># Altitude/elevation</span>
    <span class="n">altaz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dircos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">dircos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Azimuth (measured from North)</span>
    <span class="n">altaz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;radians&#39;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">altaz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">altaz</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="hadec2altaz"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.hadec2altaz">[docs]</a><span class="k">def</span> <span class="nf">hadec2altaz</span><span class="p">(</span><span class="n">hadec</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert HA and declination to altitude and azimuth</span>

<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">    hadec:       HA and declination as a list of tuples or Nx2 Numpy array</span>
<span class="sd">    </span>
<span class="sd">    latitude:    Latitude of the observatory. </span>

<span class="sd">    Keyword Inputs:</span>

<span class="sd">    units:       [Default = &#39;radians&#39;] Units of HA, dec and latitude. Could be</span>
<span class="sd">                 &#39;radians&#39; or &#39;degrees&#39;. </span>

<span class="sd">    Output:</span>
<span class="sd">    </span>
<span class="sd">    altaz:       Altitude and azimuth corresponding to HA and dec at the given</span>
<span class="sd">                 latitude. Units are identical to those in input.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">hadec</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No HA or declination specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">latitude</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No latitude specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Latitude should be a scalar number.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hadec</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hadec</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hadec</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;hadec should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">hadec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">hadec</span> <span class="o">=</span> <span class="p">(</span><span class="n">hadec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hadec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">hadec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;hadec should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hadec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">hadec</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;hadec should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;hadec should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="n">hadec</span> <span class="o">=</span> <span class="p">[((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">hadec</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">hadec</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;hadec should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hadec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">hadec</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hadec</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">hadec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">hadec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;hadec should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hadec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">hadec</span> <span class="o">=</span> <span class="n">hadec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">hadec</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">hadec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;radians&#39;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">hadec</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">hadec</span><span class="p">)</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">hadec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Declination(s) should lie between -90 and 90 degrees. Check inputs and units.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Latitude should lie between -90 and 90 degrees. Check inputs and units.&#39;</span><span class="p">)</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">sin_alt</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">hadec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span> <span class="o">+</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">hadec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">hadec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">valid_ind</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sin_alt</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="o">+</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">sin_alt</span><span class="p">[</span><span class="n">valid_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sin_alt</span><span class="p">[</span><span class="n">valid_ind</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">altitude</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_alt</span><span class="p">)</span>
    <span class="n">zenith_ind</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sin_alt</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span>
    <span class="n">cos_az</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zenith_ind</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sin_alt</span><span class="p">),</span> <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">hadec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude</span><span class="p">)))</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="n">valid_ind</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cos_az</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="o">+</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">cos_az</span><span class="p">[</span><span class="n">valid_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cos_az</span><span class="p">[</span><span class="n">valid_ind</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cos_az</span><span class="p">)</span>

    <span class="c1"># Need to make sure the values are in the conventional range</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">hadec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">azimuth</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">altitude</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span>
        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">azimuth</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">altitude</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">))</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="altaz2hadec"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.altaz2hadec">[docs]</a><span class="k">def</span> <span class="nf">altaz2hadec</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert altitude and azimuth to HA and declination. Same transformation</span>
<span class="sd">    function as hadec2altaz, replace azimuth with HA and altitude with declination.</span>

<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">    altaz:       Altitude and azimtuh as a list of tuples or Nx2 Numpy array</span>
<span class="sd">    </span>
<span class="sd">    latitude:    Latitude of the observatory. </span>

<span class="sd">    Keyword Inputs:</span>

<span class="sd">    units:       [Default = &#39;radians&#39;] Units of HA, dec and latitude. Could be</span>
<span class="sd">                 radians or degrees. </span>

<span class="sd">    Output:</span>
<span class="sd">    </span>
<span class="sd">    hadec:       HA and declination corresponding to altitude and azimuth given</span>
<span class="sd">                 latitude. Units are identical to those in input.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">altaz</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No altitude or azimuth specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">latitude</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No latitude specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Latitude should be a scalar number.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">altaz</span> <span class="o">=</span> <span class="p">(</span><span class="n">altaz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">altaz</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">altaz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">altaz</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="n">altaz</span> <span class="o">=</span> <span class="p">[((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">altaz</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">altaz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;altaz should be a 2-element tuple, a list of 2-element tuples, a 2-element list of scalars, or a Nx2 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">altaz</span><span class="o">.</span><span class="n">shape</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">altaz</span> <span class="o">=</span> <span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">altaz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;radians&#39;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">altaz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Altitude(s) should lie between 0 and 90 degrees. Check inputs and units.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Latitude should lie between -90 and 90 degrees. Check inputs and units.&#39;</span><span class="p">)</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-10</span>

    <span class="n">arg</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span> <span class="o">+</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">valueError</span><span class="p">(</span><span class="s1">&#39;Non-physical angles found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

    <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">valueError</span><span class="p">(</span><span class="s1">&#39;Non-physical angles found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
 
    <span class="c1"># Make sure the conventions are taken into account</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altaz</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ha</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">ha</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">ha</span> <span class="o">*=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">dec</span> <span class="o">*=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">dec</span><span class="p">))</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="enu2xyz"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.enu2xyz">[docs]</a><span class="k">def</span> <span class="nf">enu2xyz</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert local ENU coordinates in local tangential plane to XYZ in equatorial</span>
<span class="sd">    coordinates.</span>

<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">    enu:         local ENU coordinates in local tangential plane as a list of</span>
<span class="sd">                 tuples or Nx3 Numpy array. First column refers to local East,</span>
<span class="sd">                 second to local North and third to local Up.</span>
<span class="sd">    </span>
<span class="sd">    latitude:    Latitude of the observatory. </span>

<span class="sd">    Keyword Inputs:</span>

<span class="sd">    units:       [Default = &#39;radians&#39;] Units of latitude. Could be radians or</span>
<span class="sd">                 degrees. </span>

<span class="sd">    Output:</span>
<span class="sd">    </span>
<span class="sd">    xyz:         Equatorial XYZ coordinates corresponding to local ENU </span>
<span class="sd">                 coordinates given latitude. Units are identical to those in</span>
<span class="sd">                 input. First column refers to X (ha=0, dec=0), second column to</span>
<span class="sd">                 Y (ha=-6h, dec=0), and third column to north celestial pole </span>
<span class="sd">                 Z (dec=90)</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">enu</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No baselines specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">latitude</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No latitude specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Latitude should be a scalar number.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;enu should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">enu</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">enu</span> <span class="o">=</span> <span class="p">(</span><span class="n">enu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">enu</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">enu</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">enu</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;enu should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">enu</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;enu should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;enu should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="n">enu</span> <span class="o">=</span> <span class="p">[((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">enu</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">enu</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;enu should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">enu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;enu should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">enu</span><span class="o">.</span><span class="n">shape</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">enu</span> <span class="o">=</span> <span class="n">enu</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">enu</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">enu</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>

    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude</span><span class="p">)],</span>
                                  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>               <span class="mf">0.0</span>             <span class="p">],</span>
                                  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latitude</span><span class="p">),</span>  <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latitude</span><span class="p">)]])</span>

    <span class="n">xyz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xyz</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="xyz2enu"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.xyz2enu">[docs]</a><span class="k">def</span> <span class="nf">xyz2enu</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert equatorial XYZ coordinates to local ENU coordinates in the local </span>
<span class="sd">    tangential plane.</span>

<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">    xyz:         equatorial XYZ coordinates as a list of tuples or Nx3 Numpy</span>
<span class="sd">                 array. First column refers to X (ha=0, dec=0), second column to</span>
<span class="sd">                 Y (ha=-6h, dec=0), and third column to north celestial pole </span>
<span class="sd">                 Z (dec=90)</span>
<span class="sd">    </span>
<span class="sd">    latitude:    Latitude of the observatory. </span>

<span class="sd">    Keyword Inputs:</span>

<span class="sd">    units:       [Default = &#39;radians&#39;] Units of latitude. Could be radians or</span>
<span class="sd">                 degrees. </span>

<span class="sd">    Output:</span>
<span class="sd">    </span>
<span class="sd">    enu:         local ENU coordinates in the local tangential plane</span>
<span class="sd">                 corresponding to equatorial XYZ coordinates given latitude.</span>
<span class="sd">                 Units are identical to those in input. First column refers to </span>
<span class="sd">                 local East, second to local North and third to local Up.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">xyz</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No baselines specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">latitude</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No latitude specified. Check inputs.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Latitude should be a scalar number.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;xyz should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;xyz should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;xyz should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;xyz should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="p">[((</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;xyz should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;xyz should be a 3-element tuple, a list of 3-element tuples, a 3-element list of scalars, or a Nx3 numpy array. Check inputs.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">xyz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>

    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="mf">0.0</span>               <span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">latitude</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">latitude</span><span class="p">)],</span>
                                  <span class="p">[</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">latitude</span><span class="p">)</span> <span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">latitude</span><span class="p">)]])</span>

    <span class="n">enu</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">enu</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="lla2ecef"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.lla2ecef">[docs]</a><span class="k">def</span> <span class="nf">lla2ecef</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert geodetic latitude, longitude and altitude to XYZ in ECEF coordinates</span>
<span class="sd">    based on WGS84 parameters</span>

<span class="sd">    Inputs:</span>

<span class="sd">    lat     [scalar or numpy array] Geodetic latitude in units specified by </span>
<span class="sd">            input units. Same size as lon and alt</span>

<span class="sd">    lon     [scalar or numpy array] Geodetic longitude in units specified by </span>
<span class="sd">            input units. Same size as lat and alt.</span>

<span class="sd">    alt     [scalar or numpy array] Geodetic altitude in meters. Same size as </span>
<span class="sd">            lat and lon. If set to None, it is assumed to be zeros.</span>

<span class="sd">    units   [string] Specifies units of inputs lat and lon. Accepted values are</span>
<span class="sd">            &#39;radians&#39; (default) or &#39;degrees&#39;</span>

<span class="sd">    Outputs:</span>

<span class="sd">    Tuple (x,y,z) where x, y and z in meters are the components in the ECEF </span>
<span class="sd">    system. Each will be of same size as lat</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Inputs lat and lon must be specified&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;degrees&#39;</span><span class="p">,</span> <span class="s1">&#39;radians&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid input specified for &quot;units&quot;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input lat must be a scalar or numpy array&#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input lon must be a scalar or numpy array&#39;</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lat</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">lon</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs lat and lon must be of same size&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input alt must be a scalar or numpy array&#39;</span><span class="p">)</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alt</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">lat</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input alt must have same size as input lat&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">!=</span> <span class="s1">&#39;radians&#39;</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="n">gps_a</span> <span class="o">=</span> <span class="mf">6378137.0</span>
    <span class="n">gps_f</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">298.257223563</span> <span class="c1"># flattening parameter</span>
    <span class="n">gps_b</span> <span class="o">=</span> <span class="n">gps_a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gps_f</span><span class="p">)</span>
    <span class="n">e_sqr</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">gps_b</span><span class="o">/</span><span class="n">gps_a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># first eccentricity</span>
    <span class="n">eprime_sqr</span> <span class="o">=</span> <span class="p">(</span><span class="n">gps_a</span><span class="o">/</span><span class="n">gps_b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="c1"># second eccentricity</span>
    <span class="n">gps_N</span> <span class="o">=</span> <span class="n">gps_a</span> <span class="o">/</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e_sqr</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Radius of curvature</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">gps_N</span> <span class="o">+</span> <span class="n">alt</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">gps_N</span> <span class="o">+</span> <span class="n">alt</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">gps_b</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">gps_a</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">gps_N</span> <span class="o">+</span> <span class="n">alt</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="ecef2lla"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.ecef2lla">[docs]</a><span class="k">def</span> <span class="nf">ecef2lla</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert XYZ in ECEF to geodetic latitude, longitude and altitude coordinates</span>
<span class="sd">    based on WGS84 parameters</span>

<span class="sd">    Inputs:</span>

<span class="sd">    x       [scalar or numpy array] x-coordinate (in m) in ECEF system </span>

<span class="sd">    y       [scalar or numpy array] y-coordinate (in m) in ECEF system </span>

<span class="sd">    z       [scalar or numpy array] z-coordinate (in m) in ECEF system </span>

<span class="sd">    units   [string] Specifies units of outputs lat and lon. Accepted values are</span>
<span class="sd">            &#39;radians&#39; (default) or &#39;degrees&#39;</span>

<span class="sd">    Outputs:</span>

<span class="sd">    Tuple (lat, lon, alt) where lat (angle units), lon (angle units) and alt (m) </span>
<span class="sd">    are the geodetic latitude, longitudes and altitudes in WGS 84 system</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Inputs x, y, z must be specified&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;degrees&#39;</span><span class="p">,</span> <span class="s1">&#39;radians&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid input specified for &quot;units&quot;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input x must be a scalar or numpy array&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input y must be a scalar or numpy array&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input z must be a scalar or numpy array&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Inputs x, y and z must be of same size&#39;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># checking for acceptable values for Earth&#39;s surface</span>
    <span class="n">xyz_radius</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">xyz_radius</span> <span class="o">&lt;</span> <span class="mf">6.35e6</span><span class="p">,</span> <span class="n">xyz_radius</span> <span class="o">&gt;</span> <span class="mf">6.39e6</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;xyz values should be topocentric ECEF coordinates in meters&#39;</span><span class="p">)</span>

    <span class="n">gps_a</span> <span class="o">=</span> <span class="mf">6378137.0</span>
    <span class="n">gps_f</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">298.257223563</span> <span class="c1"># flattening parameter</span>
    <span class="n">gps_b</span> <span class="o">=</span> <span class="n">gps_a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gps_f</span><span class="p">)</span>
    <span class="n">e_sqr</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">gps_b</span><span class="o">/</span><span class="n">gps_a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># first eccentricity</span>
    <span class="n">eprime_sqr</span> <span class="o">=</span> <span class="p">(</span><span class="n">gps_a</span><span class="o">/</span><span class="n">gps_b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="c1"># second eccentricity</span>
    <span class="c1"># gps_N = gps_a / NP.sqrt(1.0 - e_sqr * NP.sin(x)**2) # Radius of curvature (Wrong)</span>
    <span class="n">gps_p</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">gps_theta</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="n">gps_a</span><span class="p">,</span> <span class="n">gps_p</span> <span class="o">*</span> <span class="n">gps_b</span><span class="p">)</span>

    <span class="n">lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="n">eprime_sqr</span> <span class="o">*</span> <span class="n">gps_b</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gps_theta</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">gps_p</span> <span class="o">-</span> <span class="n">e_sqr</span> <span class="o">*</span> <span class="n">gps_a</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gps_theta</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">gps_N</span> <span class="o">=</span> <span class="n">gps_a</span> <span class="o">/</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e_sqr</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Radius of curvature</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">gps_p</span> <span class="o">/</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="n">gps_N</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">!=</span> <span class="s1">&#39;radians&#39;</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="ecef2enu"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.ecef2enu">[docs]</a><span class="k">def</span> <span class="nf">ecef2enu</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">ref_info</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert XYZ in ECEF based on WGS 84 parameters to local ENU coordinates</span>
<span class="sd">    (Refer to Wikipedia </span>
<span class="sd">    https://en.wikipedia.org/wiki/Geographic_coordinate_conversion)</span>

<span class="sd">    Inputs:</span>

<span class="sd">    xyz     [numpy array] xyz-coordinates (in m) in ECEF system. It is of size</span>
<span class="sd">            nloc x 3.</span>

<span class="sd">    ref_info</span>
<span class="sd">            [dictionary] contains information about the reference point relative </span>
<span class="sd">            to which all the ENU coordinates will be estimated. It consists of </span>
<span class="sd">            the following keys and information:</span>
<span class="sd">            &#39;xyz&#39;   [3-element numpy array] ECEF XYZ location of the reference</span>
<span class="sd">                    point</span>
<span class="sd">            &#39;lat&#39;   [scalar] geodetic latitude (in radians or degrees as </span>
<span class="sd">                    specified by key &#39;units&#39;) of reference point </span>
<span class="sd">            &#39;lon&#39;   [scalar] geodetic longitude (in radians or degrees as </span>
<span class="sd">                    specified by key &#39;units&#39;) of reference point </span>
<span class="sd">            &#39;units&#39; [string] Specifies units of lat and lon of reference point. </span>
<span class="sd">                    Accepted values are &#39;radians&#39; (default) or &#39;degrees&#39;</span>

<span class="sd">    Outputs:</span>

<span class="sd">    Numpy array containing converted local ENU locations of the input ECEF </span>
<span class="sd">    locations. It will be of size nloc x 3</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">xyz</span><span class="p">,</span> <span class="n">ref_info</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Inputs xyz and ref_info must be specified&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input xyz must be a numpy array&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input xyz must be a 3-column array&#39;</span><span class="p">)</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">xyz</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input xyz must be a 3-column array&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input xyz must be a 2D 3-column array&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;xyz&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">],</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;xyz&quot; in input ref_info must be a 3-element numpy array&#39;</span><span class="p">)</span>
                <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;xyz&quot; in input ref_info must be a numpy array&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key &quot;xyz&quot; not found in input ref_info&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;lat&quot; in input ref_info must be a scalar number&#39;</span><span class="p">)</span>
            <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key &quot;lat&quot; not found in input ref_info&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;lon&quot; in input ref_info must be a scalar number&#39;</span><span class="p">)</span>
            <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key &quot;lon&quot; not found in input ref_info&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;degrees&#39;</span><span class="p">,</span> <span class="s1">&#39;radians&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid specification for value under key &quot;units&quot; in input ref_info&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Value under key &quot;units&quot; in input ref_info not specified. Assuming the units are in radians.&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input ref_info must be a dictionary&#39;</span><span class="p">)</span>

    <span class="n">ref_lat</span> <span class="o">=</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="n">ref_lon</span> <span class="o">=</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;radians&#39;</span><span class="p">:</span>
        <span class="n">ref_lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span>
        <span class="n">ref_lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">)</span>

    <span class="n">xyz_rel</span> <span class="o">=</span> <span class="n">xyz</span> <span class="o">-</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rot_matrix</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">],</span>
                             <span class="p">[</span><span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)]])</span>
    <span class="n">enu</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz_rel</span><span class="p">,</span> <span class="n">rot_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enu</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="enu2ecef"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.enu2ecef">[docs]</a><span class="k">def</span> <span class="nf">enu2ecef</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="n">ref_info</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert local ENU coordinates to XYZ in ECEF based on WGS 84 parameters</span>
<span class="sd">    (Refer to Wikipedia </span>
<span class="sd">    https://en.wikipedia.org/wiki/Geographic_coordinate_conversion)</span>

<span class="sd">    Inputs:</span>

<span class="sd">    enu     [numpy array] local ENU-coordinates (in m). It is of size nloc x 3.</span>

<span class="sd">    ref_info</span>
<span class="sd">            [dictionary] contains information about the reference point relative </span>
<span class="sd">            to which all the ECEF coordinates will be estimated. It consists of </span>
<span class="sd">            the following keys and information:</span>
<span class="sd">            &#39;xyz&#39;   [3-element numpy array] ECEF XYZ location of the reference</span>
<span class="sd">                    point</span>
<span class="sd">            &#39;lat&#39;   [scalar] geodetic latitude (in radians or degrees as </span>
<span class="sd">                    specified by key &#39;units&#39;) of reference point </span>
<span class="sd">            &#39;lon&#39;   [scalar] geodetic longitude (in radians or degrees as </span>
<span class="sd">                    specified by key &#39;units&#39;) of reference point </span>
<span class="sd">            &#39;units&#39; [string] Specifies units of lat and lon of reference point. </span>
<span class="sd">                    Accepted values are &#39;radians&#39; (default) or &#39;degrees&#39;</span>

<span class="sd">    Outputs:</span>

<span class="sd">    Numpy array containing converted ECEF XYZ locations of the input local ENU </span>
<span class="sd">    locations. It will be of size nloc x 3</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">enu</span><span class="p">,</span> <span class="n">ref_info</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Inputs enu and ref_info must be specified&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input enu must be a numpy array&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">enu</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">enu</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input enu must be a 3-column array&#39;</span><span class="p">)</span>
        <span class="n">enu</span> <span class="o">=</span> <span class="n">enu</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">enu</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">enu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input enu must be a 3-column array&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input enu must be a 2D 3-column array&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;enu&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;enu&#39;</span><span class="p">],</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;enu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;enu&quot; in input ref_info must be a 3-element numpy array&#39;</span><span class="p">)</span>
                <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;enu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;enu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;enu&quot; in input ref_info must be a numpy array&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key &quot;enu&quot; not found in input ref_info&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;lat&quot; in input ref_info must be a scalar number&#39;</span><span class="p">)</span>
            <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key &quot;lat&quot; not found in input ref_info&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value under key &quot;lon&quot; in input ref_info must be a scalar number&#39;</span><span class="p">)</span>
            <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Key &quot;lon&quot; not found in input ref_info&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">ref_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;degrees&#39;</span><span class="p">,</span> <span class="s1">&#39;radians&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid specification for value under key &quot;units&quot; in input ref_info&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Value under key &quot;units&quot; in input ref_info not specified. Assuming the units are in radians.&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input ref_info must be a dictionary&#39;</span><span class="p">)</span>

    <span class="n">ref_lat</span> <span class="o">=</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="n">ref_lon</span> <span class="o">=</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;radians&#39;</span><span class="p">:</span>
        <span class="n">ref_lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span>
        <span class="n">ref_lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">)</span>

    <span class="n">rot_matrix</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="o">-</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lon</span><span class="p">)],</span>
                             <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ref_lat</span><span class="p">)]])</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">enu</span><span class="p">,</span> <span class="n">rot_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">ref_info</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xyz</span></div>

<span class="c1">#################################################################################</span>

<span class="c1"># def angular_ring(skypos, angles, npoints=100, skyunits=&#39;radec&#39;, angleunits=&#39;degrees&#39;):</span>

<span class="c1">#     skypos = NP.radians(skypos).reshape(-1,2)</span>
<span class="c1">#     angles = NP.asarray(angles).reshape(1,-1)</span>
<span class="c1">#     if angleunits == &#39;degrees&#39;:</span>
<span class="c1">#         angles = NP.radians(angles)</span>

<span class="c1">#     azangle = 2.0 * NP.pi * NP.arange(npoints)/npoints </span>

<span class="c1">#     radec = NP.empty((npoints, 2, skypos.shape[0]))</span>

<span class="c1">#     for i in range(skypos.shape[0]):</span>
<span class="c1">#         local_enu = NP.hstack((NP.sin(angles[i])*NP.cos(azangle).reshape(-1,1), NP.sin(angles[i])*NP.sin(azangle).reshape(-1,1), NP.cos(angles[i])*NP.ones((npoints,1))))</span>
<span class="c1">#         rotation_matrix = NP.asarray([[0.0, -NP.sin(skypos[i,1]), NP.cos(skypos[i,1])],</span>
<span class="c1">#                                       [1.0, 0.0,                  0.0              ],</span>
<span class="c1">#                                       [0.0, NP.cos(skypos[i,1]),  NP.sin(skypos[i,1])]])</span>
<span class="c1">#         xyz = NP.dot(local_enu, rotation_matrix.T)</span>
<span class="c1">#         ring_dec = NP.degrees(NP.arcsin(xyz[:,2]))</span>
<span class="c1">#         ring_az = NP.degrees(NP.arctan(xyz[:,1], xyz[:,0]))</span>
<span class="c1">#         ring_ra = NP.degrees(skypos[:,0]) + ring_az</span>

<span class="c1">#         radec[:,0,i] = ring_ra</span>
<span class="c1">#         radec[:,1,i] = ring_dec</span>

<span class="c1">#         return radec</span>

<span class="c1">#     # local_east = NP.repeat(NP.cos(azangle).reshape(npoints,-1), len(angles), axis=1) * NP.repeat(NP.sin(angles).reshape(-1,len(angles)), npoints, axis=0)</span>
<span class="c1">#     # local_north = NP.repeat(NP.sin(azangle).reshape(npoints,-1), len(angles), axis=1) * NP.repeat(NP.sin(angles).reshape(-1,len(angles)), npoints, axis=0)</span>
<span class="c1">#     # local_up = NP.repeat(NP.cos(angles).reshape(-1,len(angles)), npoints, axis=0) </span>

<span class="c1">#     # Rotate the &quot;north&quot; and &quot;up&quot; to equatorial coordinates by the declination provided</span>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="sph2xyz"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.sph2xyz">[docs]</a><span class="k">def</span> <span class="nf">sph2xyz</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert from spherical coordinates (radius, latitude, longigtude) to </span>
<span class="sd">    Cartesian coordinates</span>

<span class="sd">    Inputs:</span>

<span class="sd">    lon [scalar or vector] longitude in degrees.  </span>

<span class="sd">    lat [scalar or vector] latitude in degrees. Same size as lon.</span>

<span class="sd">    rad [Optional. scalar or vector] radius. Same size as lon and lat.</span>
<span class="sd">        Default = 1.0</span>

<span class="sd">    Outputs:</span>

<span class="sd">    x   [scalar or vector] x-coordinates. Same size as lon and lat</span>

<span class="sd">    y   [scalar or vector] y-coordinates. Same size as lon and lat</span>

<span class="sd">    z   [scalar or vector] z-coordinates. Same size as lon and lat</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;lon and/or lat not defined in sph2xyz().&#39;</span><span class="p">)</span>

    <span class="n">lonr</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="n">latr</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lonr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">latr</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon and lat should have same size in sph2xyz().&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rad</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lonr</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lonr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">rad</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rad must have same size as lon and lat in sph2xyz().&#39;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">rad</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lonr</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latr</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rad</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lonr</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">latr</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">rad</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">latr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="xyz2sph"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.xyz2sph">[docs]</a><span class="k">def</span> <span class="nf">xyz2sph</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Convert from Cartesian coordinates to spherical coordinates (radius, latitude</span>
<span class="sd">    and longitude)</span>

<span class="sd">    Inputs:</span>

<span class="sd">    x       [scalar or vector] x-coordinates. Same size as y and z</span>
<span class="sd">            </span>
<span class="sd">    y       [scalar or vector] y-coordinates. Same size as x and z</span>
<span class="sd">            </span>
<span class="sd">    z       [scalar or vector] z-coordinates. Same size as x and y</span>

<span class="sd">    units   [string] Specifies units of output latitude and longitude. If set</span>
<span class="sd">            to &#39;degrees&#39; it will be in degrees, otherwise in radians</span>

<span class="sd">    Outputs:</span>

<span class="sd">    r   [scalar or vector] radius. Same size and units as x, y and z </span>

<span class="sd">    lon [scalar or vector] longitude in units specified by keyword input &#39;units&#39;</span>

<span class="sd">    lat [scalar or vector] latitude in units specified by keyword input &#39;units&#39;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;x, y, and z must be defined in xyz2sph().&#39;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">r</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="sphdist"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.sphdist">[docs]</a><span class="k">def</span> <span class="nf">sphdist</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Returns great circle distance.  </span>

<span class="sd">    Uses vicenty distance formula - a bit slower than others, but numerically</span>
<span class="sd">    stable.</span>

<span class="sd">    Inputs: </span>

<span class="sd">    lon1 [scalar or vector] Longtitude in first list in degrees</span>

<span class="sd">    lat1 [scalar or vector] Latitude in first list in degrees. Must be of same</span>
<span class="sd">         size as lon1 if vector</span>

<span class="sd">    lon2 [scalar or vector] Longtitude in second list in degrees. Must be of same</span>
<span class="sd">         size as lon1 if vector</span>

<span class="sd">    lat2 [scalar or vector] Latitude in second list in degrees. Must be of same</span>
<span class="sd">         size as lon1 if vector</span>

<span class="sd">    Outputs:</span>

<span class="sd">    Angular distance (in degrees) subtended on the great circle between the given</span>
<span class="sd">    set of points. Same size as the inputs.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;At least one of lon1, lat1, lon2, lat2 undefined in sphdist().&#39;</span><span class="p">)</span>
        
    <span class="n">lon1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span>
    <span class="n">lat1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lon1</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">lat1</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon1 and lat1 must be of same size in sphdist().&#39;</span><span class="p">)</span>

    <span class="n">lon2</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span>
    <span class="n">lat2</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lon2</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">lat2</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon2 and lat2 must be of same size in sphdist().&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lon1</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">lon2</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lon1</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lon1</span> <span class="o">=</span> <span class="n">lon1</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lon2</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">lat1</span> <span class="o">=</span> <span class="n">lat1</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lat2</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lon2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lon2</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lon1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">lat2</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lat1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;first and second sets of coordinates must have same size.&#39;</span><span class="p">)</span>

    <span class="c1"># terminology from the Vicenty formula - lambda and phi and</span>
    <span class="c1"># &quot;standpoint&quot; and &quot;forepoint&quot;</span>

    <span class="n">lambs</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span>
    <span class="n">phis</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>
    <span class="n">lambf</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span>
    <span class="n">phif</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>

    <span class="n">dlamb</span> <span class="o">=</span> <span class="n">lambf</span> <span class="o">-</span> <span class="n">lambs</span>

    <span class="n">numera</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phif</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlamb</span><span class="p">)</span>
    <span class="n">numerb</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phif</span><span class="p">)</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phif</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dlamb</span><span class="p">)</span>
    <span class="n">numer</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">numera</span><span class="p">,</span> <span class="n">numerb</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phif</span><span class="p">)</span> <span class="o">+</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phif</span><span class="p">)</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dlamb</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">NP</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">numer</span><span class="p">,</span> <span class="n">denom</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="spherematch"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.spherematch">[docs]</a><span class="k">def</span> <span class="nf">spherematch</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lat2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">matchrad</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nnearest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">maxmatches</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Finds matches in one catalog to another. Matches for the first catalog are</span>
<span class="sd">    searched for in the second catalog.</span>

<span class="sd">    Parameters</span>
<span class="sd">    lon1 : array-like</span>
<span class="sd">         Longitude-like (RA, etc.) coordinate in degrees of the first catalog</span>
<span class="sd">    lat1 : array-like</span>
<span class="sd">        Latitude-like (Dec, etc.) coordinate in degrees of the first catalog</span>
<span class="sd">        (shape of array must match `lon1`)</span>
<span class="sd">    lon2 : array-like</span>
<span class="sd">        Latitude-like (RA, etc.) coordinate in degrees of the second catalog</span>
<span class="sd">    lat2 : array-like</span>
<span class="sd">        Latitude-like (Dec, etc.) in degrees of the second catalog (shape of</span>
<span class="sd">        array must match `ra2`)</span>
<span class="sd">    matchrad : float or None, optional</span>
<span class="sd">        How close (in degrees) a match has to be to count as a match.  If None,</span>
<span class="sd">        all nearest neighbors for the first catalog will be returned. </span>
<span class="sd">    nnearest : int, optional</span>
<span class="sd">        The nth nearest neighbor to find. Default = 0 (if maxmatches &gt;= 0,</span>
<span class="sd">        maxmatches is used, else nnearest is set to 1 thereby searching for the</span>
<span class="sd">        first nearest neighbour)</span>
<span class="sd">    maxmatches : int, optional</span>
<span class="sd">        Maximum number of matches to find. If maxmatches &gt; 0, the code finds </span>
<span class="sd">        all matches up to maxmatches satisfying matchrad. If maxmatches = 0, all</span>
<span class="sd">        matches upto matchrad are found. And nnearest is ignored. Default = -1 </span>
<span class="sd">        (nnearest, if positive, is used instead of maxmatches. if nnearest is 0, </span>
<span class="sd">        then nnearest is set to 1 and the first nearest neighbour is searched.)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1 : int array</span>
<span class="sd">        Indices into the first catalog of the matches. </span>
<span class="sd">    m2 : int array</span>
<span class="sd">        Indices into the second catalog of the matches. </span>
<span class="sd">    d12 : float array</span>
<span class="sd">        Distance (in degrees) between the matches </span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;lon1 and/or lat1 not defined. Aborting spherematch()&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">nnearest</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nnearest</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;nnearest should be a non-negative integer.&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">maxmatches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxmatches</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;maxmatches should be a non-negative integer.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">matchrad</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">maxmatches</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nnearest</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">print</span> <span class="s1">&#39;No matchrad specified. Will determine all the {0} nearest neighbours.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxmatches</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxmatches</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">nnearest</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nnearest</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;No matchrad specified. Will determine the nearest neighbour # {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nnearest</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matchrad</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;matchrad should be a scalar number.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">matchrad</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">matchrad_cartesian</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">matchrad</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxmatches</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nnearest</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nnearest</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nnearest</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;maxmatches is negative. Will determine the nearest neighbour # {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nnearest</span><span class="p">)</span>            
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;matchrad is not positive.&#39;</span><span class="p">)</span>

    <span class="n">self_match</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lon2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lat2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">self_match</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="n">lon2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="n">lon1</span>
    <span class="k">elif</span> <span class="n">lat2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="n">lat2</span>

    <span class="k">if</span> <span class="n">lon1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">lat1</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon1 and lat1 should be of same length&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">self_match</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lon2</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">lat2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon2 and lat2 should be of same length&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">lon1</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lon2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">sph2xyz</span><span class="p">(</span><span class="n">lon1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">lat1</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="c1"># this is equivalent to, but faster than just doing NP.array([x1, y1, z1])</span>
    <span class="n">coords1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">x1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">coords1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span>
    <span class="n">coords1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y1</span>
    <span class="n">coords1</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z1</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">lon2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lat2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">sph2xyz</span><span class="p">(</span><span class="n">lon2</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">lat2</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="c1"># this is equivalent to, but faster than just doing NP.array([x1, y1, z1])</span>
        <span class="n">coords2</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">x2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">coords2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span>
        <span class="n">coords2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y2</span>
        <span class="n">coords2</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z2</span>
    
    <span class="k">if</span> <span class="n">maxmatches</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">kdt1</span> <span class="o">=</span> <span class="n">KDT</span><span class="p">(</span><span class="n">coords1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self_match</span><span class="p">:</span>
            <span class="n">kdt2</span> <span class="o">=</span> <span class="n">KDT</span><span class="p">(</span><span class="n">coords2</span><span class="p">)</span>
            <span class="n">ngbr_of_first_in_second</span> <span class="o">=</span> <span class="n">kdt1</span><span class="o">.</span><span class="n">query_ball_tree</span><span class="p">(</span><span class="n">kdt2</span><span class="p">,</span> <span class="n">matchrad_cartesian</span><span class="p">)</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ngbr_of_first_in_second</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ngbr_of_first_in_second</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ngbr_of_first_in_second</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]]</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ngbr_of_first_in_second</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ngbr_of_first_in_second</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ngbr_of_first_in_second</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]]</span>
            <span class="n">d12</span> <span class="o">=</span> <span class="n">sphdist</span><span class="p">(</span><span class="n">lon1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lat1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lon2</span><span class="p">[</span><span class="n">m2</span><span class="p">],</span> <span class="n">lat2</span><span class="p">[</span><span class="n">m2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ngbr_of_first_in_itself</span> <span class="o">=</span> <span class="n">kdt1</span><span class="o">.</span><span class="n">query_ball_tree</span><span class="p">(</span><span class="n">kdt1</span><span class="p">,</span> <span class="n">matchrad_cartesian</span><span class="p">)</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ngbr_of_first_in_itself</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ngbr_of_first_in_itself</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ngbr_of_first_in_itself</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ngbr_of_first_in_itself</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ngbr_of_first_in_itself</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">ngbr_of_first_in_itself</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">d12</span> <span class="o">=</span> <span class="n">sphdist</span><span class="p">(</span><span class="n">lon1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lat1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lon1</span><span class="p">[</span><span class="n">m2</span><span class="p">],</span> <span class="n">lat1</span><span class="p">[</span><span class="n">m2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self_match</span><span class="p">:</span>
            <span class="n">kdt2</span> <span class="o">=</span> <span class="n">KDT</span><span class="p">(</span><span class="n">coords2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matchrad</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">kdt2</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxmatches</span><span class="p">,</span><span class="n">nnearest</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">kdt2</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxmatches</span><span class="p">,</span><span class="n">nnearest</span><span class="p">),</span> <span class="n">distance_upper_bound</span><span class="o">=</span><span class="n">matchrad_cartesian</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kdt1</span> <span class="o">=</span> <span class="n">KDT</span><span class="p">(</span><span class="n">coords1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matchrad</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">kdt1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxmatches</span><span class="p">,</span><span class="n">nnearest</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">kdt2</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxmatches</span><span class="p">,</span><span class="n">nnearest</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">distance_upper_bound</span><span class="o">=</span><span class="n">matchrad_cartesian</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">nnearest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lon1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nnearest</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">m1</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lon1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lon1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">maxmatches</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">maxmatches</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[:,</span><span class="o">-</span><span class="n">maxmatches</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1"># Extract the last maxmatches columns</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">self_match</span><span class="p">:</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">&lt;</span> <span class="n">lon2</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">&lt;</span> <span class="n">lon1</span><span class="o">.</span><span class="n">size</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">self_match</span><span class="p">:</span>
            <span class="n">d12</span> <span class="o">=</span> <span class="n">sphdist</span><span class="p">(</span><span class="n">lon1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lat1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lon2</span><span class="p">[</span><span class="n">m2</span><span class="p">],</span> <span class="n">lat2</span><span class="p">[</span><span class="n">m2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d12</span> <span class="o">=</span> <span class="n">sphdist</span><span class="p">(</span><span class="n">lon1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lat1</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span> <span class="n">lon1</span><span class="p">[</span><span class="n">m2</span><span class="p">],</span> <span class="n">lat1</span><span class="p">[</span><span class="n">m2</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">matchrad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">d12</span> <span class="o">&lt;=</span> <span class="n">matchrad</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
            <span class="n">d12</span> <span class="o">=</span> <span class="n">d12</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">d12</span>        </div>

<span class="c1">#################################################################################</span>

<div class="viewcode-block" id="parabola_parameters"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.parabola_parameters">[docs]</a><span class="k">def</span> <span class="nf">parabola_parameters</span><span class="p">(</span><span class="n">dia</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">f_to_dia_ratio</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Compute parabola parameters given specific input parameters</span>

<span class="sd">    Inputs:</span>

<span class="sd">    Two and only two of the following inputs must be given</span>

<span class="sd">    dia         [scalar or numpy array] Width of the parabola </span>

<span class="sd">    f_to_dia_ratio</span>
<span class="sd">                [scalar or numpy array] ratio of focal distance to width</span>

<span class="sd">    f           [scalar or numpy array] focal distance</span>

<span class="sd">    depth       [scalar or numpy array] depth of the parabola</span>

<span class="sd">    Output:</span>

<span class="sd">    Dictionary containing the following keys and values:</span>
<span class="sd">    &#39;f&#39;         [numpy array] focal distance</span>
<span class="sd">    &#39;D&#39;         [numpy array] width of the parabola</span>
<span class="sd">    &#39;h&#39;         [numpy array] depth of the parabola</span>
<span class="sd">    &#39;f/D&#39;       [numpy array] ratio of focal distance to diameter</span>
<span class="sd">    &#39;angle&#39;     [scalar or numpy array] Opening angle between the edge and the </span>
<span class="sd">                axis of the parabola</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dia_specified</span> <span class="o">=</span> <span class="n">dia</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="n">f_to_dia_ratio_specified</span> <span class="o">=</span> <span class="n">f_to_dia_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="n">f_specified</span> <span class="o">=</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="n">depth_specified</span> <span class="o">=</span> <span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="n">dia_specified</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dia_specified</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">f_to_dia_ratio_specified</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_to_dia_ratio_specified</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">f_specified</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_specified</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">depth_specified</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">depth_specified</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">num_keywords</span> <span class="o">=</span> <span class="n">f_to_dia_ratio_specified</span> <span class="o">+</span> <span class="n">f_specified</span> <span class="o">+</span> <span class="n">depth_specified</span>
    <span class="k">if</span> <span class="n">dia_specified</span><span class="p">:</span>
        <span class="n">dia</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dia</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dia</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parabola diameter must be positive&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f_to_dia_ratio_specified</span><span class="p">:</span>
        <span class="n">f_to_dia_ratio</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f_to_dia_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">f_to_dia_ratio</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parabola f/D ratio must be positive&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f_specified</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parabola focal length must be positive&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">depth_specified</span><span class="p">:</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">depth</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parabola depth must be positive&#39;</span><span class="p">)</span>
    
    <span class="n">parms</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;f/D&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">num_keywords</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f_specified</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dia_specified</span><span class="p">:</span>
                <span class="n">f_to_dia_ratio</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">dia</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="n">dia</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">16.0</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f_to_dia_ratio_specified</span><span class="p">:</span>
                <span class="n">dia</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">f_to_dia_ratio</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="n">dia</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">16.0</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">depth_specified</span><span class="p">:</span>
                <span class="n">dia</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">16.0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">depth</span><span class="p">)</span>
                <span class="n">f_to_dia_ratio</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">dia</span>
        <span class="k">elif</span> <span class="n">dia_specified</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f_to_dia_ratio_specified</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">dia</span> <span class="o">*</span> <span class="n">f_to_dia_ratio</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="n">dia</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">16.0</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">depth_specified</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">dia</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">16.0</span> <span class="o">*</span> <span class="n">depth</span><span class="p">)</span>
                <span class="n">f_to_dia_ratio</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">dia</span>
        <span class="k">elif</span> <span class="n">depth_specified</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f_to_dia_ratio_specified</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="mf">16.0</span> <span class="o">*</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">f_to_dia_ratio</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">dia</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">16.0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">depth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Insufficient parameters specified&#39;</span><span class="p">)</span>
        <span class="n">parms</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">parms</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dia</span>
        <span class="n">parms</span><span class="p">[</span><span class="s1">&#39;f/D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_to_dia_ratio</span>
        <span class="n">parms</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span>
        <span class="n">parms</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dia</span><span class="p">,</span> <span class="n">f</span><span class="o">-</span><span class="n">depth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Either too little or too many parameters specified for unique determination of parabola parameters&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">parms</span></div>

<span class="c1">################################################################################</span>

<div class="viewcode-block" id="sample_parabola"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.sample_parabola">[docs]</a><span class="k">def</span> <span class="nf">sample_parabola</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">open_angle</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">angunits</span><span class="o">=</span><span class="s1">&#39;degrees&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Sample points on a parabola defined by focal length and opening angle</span>

<span class="sd">    Inputs:</span>

<span class="sd">    f       [scalar] focal length, must be positive</span>

<span class="sd">    open_angle</span>
<span class="sd">            [scalar] opening angle (in units specified by input angunits) which</span>
<span class="sd">            is defined as the angle the edge of the parabola measured from the</span>
<span class="sd">            vertex of the parabola</span>

<span class="sd">    axis    [scalar] Angle the principal axis makes with the horizon (x-axis)</span>
<span class="sd">            measured counter-clockwise towards the z-axis (zenith). Default=90 </span>
<span class="sd">            degrees implies it is along the zenith</span>

<span class="sd">    wavelength</span>
<span class="sd">            [scalar] Wavelength to calculate the sampling interval. At the </span>
<span class="sd">            moment the sampling interval is fixed at one-tenth of whichever </span>
<span class="sd">            is minimum between the wavelength and diameter of the parabola</span>
<span class="sd">            </span>
<span class="sd">    angunits</span>
<span class="sd">            [string] Units of the angles specified in open_angle and axis. By</span>
<span class="sd">            default, it is set to &#39;degrees&#39;</span>

<span class="sd">    Output:</span>

<span class="sd">    Mx3 array of x, y, z positions in same units as input focal length. The </span>
<span class="sd">    y-values are zeros.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">open_angle</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Inputs focal length and opening angle must be specified&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input f must be a scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input focal length must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input wavelength must be a scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input wavelength must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">open_angle</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input open_angle must be a scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">open_angle</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input opening angle must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input axis must be a scalar&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">angunits</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">open_angle</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">open_angle</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">axis</span>

    <span class="n">theta_min</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">open_angle</span>
    <span class="n">theta_max</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">open_angle</span>

    <span class="n">rmax</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_min</span><span class="p">))</span>
    <span class="n">dia</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rmax</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_min</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nb">min</span><span class="p">([</span><span class="n">dia</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">])</span>
    <span class="n">dtheta</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">rmax</span>
    <span class="n">numsamples</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">open_angle</span><span class="o">/</span><span class="n">dtheta</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">theta_min</span><span class="o">-</span><span class="n">tilt</span><span class="p">,</span> <span class="n">theta_max</span><span class="o">-</span><span class="n">tilt</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">numsamples</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">tilt</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span>

    <span class="n">xyz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">NP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">NP</span><span class="o">.</span><span class="n">float</span><span class="p">),</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">xyz</span></div>
    
<span class="c1">################################################################################</span>

<div class="viewcode-block" id="sample_paraboloid"><a class="viewcode-back" href="../../astroutils.html#astroutils.geometry.sample_paraboloid">[docs]</a><span class="k">def</span> <span class="nf">sample_paraboloid</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">open_angle</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">270.0</span><span class="p">],</span> <span class="n">angunits</span><span class="o">=</span><span class="s1">&#39;degrees&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    Sample points on a parabola defined by focal length and opening angle</span>

<span class="sd">    Inputs:</span>

<span class="sd">    f       [scalar] focal length, must be positive</span>

<span class="sd">    open_angle</span>
<span class="sd">            [scalar] opening angle (in units specified by input angunits) which</span>
<span class="sd">            is defined as the angle the edge of the parabola measured from the</span>
<span class="sd">            vertex of the parabola</span>

<span class="sd">    axis    [list or numpy array] Angles (alta, az) the principal axis makes </span>
<span class="sd">            relative to zenith. Default=[90, 270] degrees implies it is along </span>
<span class="sd">            the z-axis (zenith)</span>

<span class="sd">    wavelength</span>
<span class="sd">            [scalar] Wavelength to calculate the sampling interval. At the </span>
<span class="sd">            moment the sampling interval is fixed at one-tenth of whichever </span>
<span class="sd">            is minimum between the wavelength and diameter of the parabola</span>
<span class="sd">            </span>
<span class="sd">    angunits</span>
<span class="sd">            [string] Units of the angles specified in open_angle and axis. By</span>
<span class="sd">            default, it is set to &#39;degrees&#39;</span>

<span class="sd">    Output:</span>

<span class="sd">    Mx3 array of x, y, z positions in same units as input focal length. The </span>
<span class="sd">    y-values are zeros.</span>
<span class="sd">    -----------------------------------------------------------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">open_angle</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Inputs focal length and opening angle must be specified&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input f must be a scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input focal length must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input wavelength must be a scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input wavelength must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">open_angle</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input open_angle must be a scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">open_angle</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input opening angle must be positive&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="n">NP</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input axis must be a list or numpy array&#39;</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input axis must be a 2-element array&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">angunits</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
        <span class="n">open_angle</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">open_angle</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">NP</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Absolute value of altitude must be less than 90 degrees&#39;</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">NP</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">if</span> <span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">theta_min</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">open_angle</span>
    <span class="n">theta_max</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">open_angle</span>

    <span class="n">rmax</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_min</span><span class="p">))</span>
    <span class="n">dia</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rmax</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_min</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nb">min</span><span class="p">([</span><span class="n">dia</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">])</span>
    <span class="n">dtheta</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">rmax</span>
    <span class="n">nside</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">hpx_angres</span> <span class="o">=</span> <span class="n">HP</span><span class="o">.</span><span class="n">nside2resol</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">hpx_angres</span> <span class="o">&gt;</span> <span class="n">dtheta</span><span class="p">:</span>
        <span class="n">nside</span> <span class="o">*=</span> <span class="mi">2</span>
        <span class="n">hpx_angres</span> <span class="o">=</span> <span class="n">HP</span><span class="o">.</span><span class="n">nside2resol</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
    <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">HP</span><span class="o">.</span><span class="n">pix2ang</span><span class="p">(</span><span class="n">nside</span><span class="p">,</span> <span class="n">NP</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">HP</span><span class="o">.</span><span class="n">nside2npix</span><span class="p">(</span><span class="n">nside</span><span class="p">)))</span>
    <span class="n">select_ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="n">theta_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">theta_max</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">select_ind</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">select_ind</span><span class="p">]</span>
    <span class="n">numsamples</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">size</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">tilt</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">NP</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">xyz</span></div>
    
<span class="c1">################################################################################</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Nithyanandan Thyagarajan.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>